import e from"d3-dispatch";import t from"d3-drag";import n from"d3-interpolate";import r from"d3-selection";import u from"d3-transition";var s="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var i={};(function(s,a){a(i,e,t,n,r,u)})(i,(function(e,t,n,r,u,i){function constant(e){return function(){return e}}function BrushEvent(e,t,n){(this||s).target=e;(this||s).type=t;(this||s).selection=n}function nopropagation(){u.event.stopImmediatePropagation()}function noevent(){u.event.preventDefault();u.event.stopImmediatePropagation()}var a={name:"drag"},o={name:"space"},l={name:"handle"},h={name:"center"};function number1(e){return[+e[0],+e[1]]}function number2(e){return[number1(e[0]),number1(e[1])]}function toucher(e){return function(t){return u.touch(t,u.event.touches,e)}}var c={name:"x",handles:["w","e"].map(type),input:function(e,t){return null==e?null:[[+e[0],t[0][1]],[+e[1],t[1][1]]]},output:function(e){return e&&[e[0][0],e[1][0]]}};var f={name:"y",handles:["n","s"].map(type),input:function(e,t){return null==e?null:[[t[0][0],+e[0]],[t[1][0],+e[1]]]},output:function(e){return e&&[e[0][1],e[1][1]]}};var d={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(type),input:function(e){return null==e?null:number2(e)},output:function(e){return e}};var p={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"};var b={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"};var m={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"};var v={overlay:+1,selection:+1,n:null,e:+1,s:null,w:-1,nw:-1,ne:+1,se:+1,sw:-1};var y={overlay:+1,selection:+1,n:-1,e:null,s:+1,w:null,nw:-1,ne:-1,se:+1,sw:+1};function type(e){return{type:e}}function defaultFilter(){return!u.event.ctrlKey&&!u.event.button}function defaultExtent(){var e=(this||s).ownerSVGElement||this||s;if(e.hasAttribute("viewBox")){e=e.viewBox.baseVal;return[[e.x,e.y],[e.x+e.width,e.y+e.height]]}return[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]}function defaultTouchable(){return navigator.maxTouchPoints||"ontouchstart"in(this||s)}function local(e){while(!e.__brush)if(!(e=e.parentNode))return;return e.__brush}function empty(e){return e[0][0]===e[1][0]||e[0][1]===e[1][1]}function brushSelection(e){var t=e.__brush;return t?t.dim.output(t.selection):null}function brushX(){return brush$1(c)}function brushY(){return brush$1(f)}function brush(){return brush$1(d)}function brush$1(e){var d=defaultExtent,w=defaultFilter,g=defaultTouchable,x=true,_=t.dispatch("start","brush","end"),M=6,k;function brush(t){var n=t.property("__brush",initialize).selectAll(".overlay").data([type("overlay")]);n.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",p.overlay).merge(n).each((function(){var e=local(this||s).extent;u.select(this||s).attr("x",e[0][0]).attr("y",e[0][1]).attr("width",e[1][0]-e[0][0]).attr("height",e[1][1]-e[0][1])}));t.selectAll(".selection").data([type("selection")]).enter().append("rect").attr("class","selection").attr("cursor",p.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var r=t.selectAll(".handle").data(e.handles,(function(e){return e.type}));r.exit().remove();r.enter().append("rect").attr("class",(function(e){return"handle handle--"+e.type})).attr("cursor",(function(e){return p[e.type]}));t.each(redraw).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",started).filter(g).on("touchstart.brush",started).on("touchmove.brush",touchmoved).on("touchend.brush touchcancel.brush",touchended).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}brush.move=function(t,n){t.selection?t.on("start.brush",(function(){emitter(this||s,arguments).beforestart().start()})).on("interrupt.brush end.brush",(function(){emitter(this||s,arguments).end()})).tween("brush",(function(){var t=this||s,u=t.__brush,i=emitter(t,arguments),a=u.selection,o=e.input("function"===typeof n?n.apply(this||s,arguments):n,u.extent),l=r.interpolate(a,o);function tween(e){u.selection=1===e&&null===o?null:l(e);redraw.call(t);i.brush()}return null!==a&&null!==o?tween:tween(1)})):t.each((function(){var t=this||s,r=arguments,u=t.__brush,a=e.input("function"===typeof n?n.apply(t,r):n,u.extent),o=emitter(t,r).beforestart();i.interrupt(t);u.selection=null===a?null:a;redraw.call(t);o.start().brush().end()}))};brush.clear=function(e){brush.move(e,null)};function redraw(){var e=u.select(this||s),t=local(this||s).selection;if(t){e.selectAll(".selection").style("display",null).attr("x",t[0][0]).attr("y",t[0][1]).attr("width",t[1][0]-t[0][0]).attr("height",t[1][1]-t[0][1]);e.selectAll(".handle").style("display",null).attr("x",(function(e){return"e"===e.type[e.type.length-1]?t[1][0]-M/2:t[0][0]-M/2})).attr("y",(function(e){return"s"===e.type[0]?t[1][1]-M/2:t[0][1]-M/2})).attr("width",(function(e){return"n"===e.type||"s"===e.type?t[1][0]-t[0][0]+M:M})).attr("height",(function(e){return"e"===e.type||"w"===e.type?t[1][1]-t[0][1]+M:M}))}else e.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function emitter(e,t,n){var r=e.__brush.emitter;return!r||n&&r.clean?new Emitter(e,t,n):r}function Emitter(e,t,n){(this||s).that=e;(this||s).args=t;(this||s).state=e.__brush;(this||s).active=0;(this||s).clean=n}Emitter.prototype={beforestart:function(){1===++(this||s).active&&((this||s).state.emitter=this||s,(this||s).starting=true);return this||s},start:function(){(this||s).starting?((this||s).starting=false,this.emit("start")):this.emit("brush");return this||s},brush:function(){this.emit("brush");return this||s},end:function(){0===--(this||s).active&&(delete(this||s).state.emitter,this.emit("end"));return this||s},emit:function(t){u.customEvent(new BrushEvent(brush,t,e.output((this||s).state.selection)),_.apply,_,[t,(this||s).that,(this||s).args])}};function started(){if((!k||u.event.touches)&&w.apply(this||s,arguments)){var t=this||s,r=u.event.target.__data__.type,d="selection"===(x&&u.event.metaKey?r="overlay":r)?a:x&&u.event.altKey?h:l,g=e===f?null:v[r],_=e===c?null:y[r],M=local(t),z=M.extent,E=M.selection,A=z[0][0],T,S,K=z[0][1],B,P,V=z[1][0],X,Y,$=z[1][1],C,D,F=0,I=0,j,G=g&&_&&x&&u.event.shiftKey,N,O,q=u.event.touches?toucher(u.event.changedTouches[0].identifier):u.mouse,H=q(t),J=H,L=emitter(t,arguments,true).beforestart();if("overlay"===r){E&&(j=true);M.selection=E=[[T=e===f?A:H[0],B=e===c?K:H[1]],[X=e===f?V:T,C=e===c?$:B]]}else{T=E[0][0];B=E[0][1];X=E[1][0];C=E[1][1]}S=T;P=B;Y=X;D=C;var Q=u.select(t).attr("pointer-events","none");var R=Q.selectAll(".overlay").attr("cursor",p[r]);if(u.event.touches){L.moved=moved;L.ended=ended}else{var U=u.select(u.event.view).on("mousemove.brush",moved,true).on("mouseup.brush",ended,true);x&&U.on("keydown.brush",keydowned,true).on("keyup.brush",keyupped,true);n.dragDisable(u.event.view)}nopropagation();i.interrupt(t);redraw.call(t);L.start()}function moved(){var e=q(t);!G||N||O||(Math.abs(e[0]-J[0])>Math.abs(e[1]-J[1])?O=true:N=true);J=e;j=true;noevent();move()}function move(){var e;F=J[0]-H[0];I=J[1]-H[1];switch(d){case o:case a:g&&(F=Math.max(A-T,Math.min(V-X,F)),S=T+F,Y=X+F);_&&(I=Math.max(K-B,Math.min($-C,I)),P=B+I,D=C+I);break;case l:g<0?(F=Math.max(A-T,Math.min(V-T,F)),S=T+F,Y=X):g>0&&(F=Math.max(A-X,Math.min(V-X,F)),S=T,Y=X+F);_<0?(I=Math.max(K-B,Math.min($-B,I)),P=B+I,D=C):_>0&&(I=Math.max(K-C,Math.min($-C,I)),P=B,D=C+I);break;case h:g&&(S=Math.max(A,Math.min(V,T-F*g)),Y=Math.max(A,Math.min(V,X+F*g)));_&&(P=Math.max(K,Math.min($,B-I*_)),D=Math.max(K,Math.min($,C+I*_)));break}if(Y<S){g*=-1;e=T,T=X,X=e;e=S,S=Y,Y=e;r in b&&R.attr("cursor",p[r=b[r]])}if(D<P){_*=-1;e=B,B=C,C=e;e=P,P=D,D=e;r in m&&R.attr("cursor",p[r=m[r]])}M.selection&&(E=M.selection);N&&(S=E[0][0],Y=E[1][0]);O&&(P=E[0][1],D=E[1][1]);if(E[0][0]!==S||E[0][1]!==P||E[1][0]!==Y||E[1][1]!==D){M.selection=[[S,P],[Y,D]];redraw.call(t);L.brush()}}function ended(){nopropagation();if(u.event.touches){if(u.event.touches.length)return;k&&clearTimeout(k);k=setTimeout((function(){k=null}),500)}else{n.dragEnable(u.event.view,j);U.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null)}Q.attr("pointer-events","all");R.attr("cursor",p.overlay);M.selection&&(E=M.selection);empty(E)&&(M.selection=null,redraw.call(t));L.end()}function keydowned(){switch(u.event.keyCode){case 16:G=g&&_;break;case 18:if(d===l){g&&(X=Y-F*g,T=S+F*g);_&&(C=D-I*_,B=P+I*_);d=h;move()}break;case 32:if(d===l||d===h){g<0?X=Y-F:g>0&&(T=S-F);_<0?C=D-I:_>0&&(B=P-I);d=o;R.attr("cursor",p.selection);move()}break;default:return}noevent()}function keyupped(){switch(u.event.keyCode){case 16:if(G){N=O=G=false;move()}break;case 18:if(d===h){g<0?X=Y:g>0&&(T=S);_<0?C=D:_>0&&(B=P);d=l;move()}break;case 32:if(d===o){if(u.event.altKey){g&&(X=Y-F*g,T=S+F*g);_&&(C=D-I*_,B=P+I*_);d=h}else{g<0?X=Y:g>0&&(T=S);_<0?C=D:_>0&&(B=P);d=l}R.attr("cursor",p[r]);move()}break;default:return}noevent()}}function touchmoved(){emitter(this||s,arguments).moved()}function touchended(){emitter(this||s,arguments).ended()}function initialize(){var t=(this||s).__brush||{selection:null};t.extent=number2(d.apply(this||s,arguments));t.dim=e;return t}brush.extent=function(e){return arguments.length?(d="function"===typeof e?e:constant(number2(e)),brush):d};brush.filter=function(e){return arguments.length?(w="function"===typeof e?e:constant(!!e),brush):w};brush.touchable=function(e){return arguments.length?(g="function"===typeof e?e:constant(!!e),brush):g};brush.handleSize=function(e){return arguments.length?(M=+e,brush):M};brush.keyModifiers=function(e){return arguments.length?(x=!!e,brush):x};brush.on=function(){var e=_.on.apply(_,arguments);return e===_?brush:e};return brush}e.brush=brush;e.brushSelection=brushSelection;e.brushX=brushX;e.brushY=brushY;Object.defineProperty(e,"__esModule",{value:true})}));const a=i.brush,o=i.brushSelection,l=i.brushX,h=i.brushY,c=i.__esModule;export default i;export{c as __esModule,a as brush,o as brushSelection,l as brushX,h as brushY};

