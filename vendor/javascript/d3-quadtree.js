var t="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var e={};(function(t,i){i(e)})(e,(function(e){function tree_add(e){var i=+(this||t)._x.call(null,e),r=+(this||t)._y.call(null,e);return add(this.cover(i,r),i,r,e)}function add(t,e,i,r){if(isNaN(e)||isNaN(i))return t;var n,h=t._root,s={data:r},a=t._x0,o=t._y0,u=t._x1,l=t._y1,_,d,f,y,c,x,v,p;if(!h)return t._root=s,t;while(h.length){(c=e>=(_=(a+u)/2))?a=_:u=_;(x=i>=(d=(o+l)/2))?o=d:l=d;if(n=h,!(h=h[v=x<<1|c]))return n[v]=s,t}f=+t._x.call(null,h.data);y=+t._y.call(null,h.data);if(e===f&&i===y)return s.next=h,n?n[v]=s:t._root=s,t;do{n=n?n[v]=new Array(4):t._root=new Array(4);(c=e>=(_=(a+u)/2))?a=_:u=_;(x=i>=(d=(o+l)/2))?o=d:l=d}while((v=x<<1|c)===(p=(y>=d)<<1|f>=_));return n[p]=h,n[v]=s,t}function addAll(e){var i,r,n=e.length,h,s,a=new Array(n),o=new Array(n),u=Infinity,l=Infinity,_=-Infinity,d=-Infinity;for(r=0;r<n;++r)if(!isNaN(h=+(this||t)._x.call(null,i=e[r]))&&!isNaN(s=+(this||t)._y.call(null,i))){a[r]=h;o[r]=s;h<u&&(u=h);h>_&&(_=h);s<l&&(l=s);s>d&&(d=s)}if(u>_||l>d)return this||t;this.cover(u,l).cover(_,d);for(r=0;r<n;++r)add(this||t,a[r],o[r],e[r]);return this||t}function tree_cover(e,i){if(isNaN(e=+e)||isNaN(i=+i))return this||t;var r=(this||t)._x0,n=(this||t)._y0,h=(this||t)._x1,s=(this||t)._y1;if(isNaN(r)){h=(r=Math.floor(e))+1;s=(n=Math.floor(i))+1}else{var a=h-r,o=(this||t)._root,u,l;while(r>e||e>=h||n>i||i>=s){l=(i<n)<<1|e<r;u=new Array(4),u[l]=o,o=u,a*=2;switch(l){case 0:h=r+a,s=n+a;break;case 1:r=h-a,s=n+a;break;case 2:h=r+a,n=s-a;break;case 3:r=h-a,n=s-a;break}}(this||t)._root&&(this||t)._root.length&&((this||t)._root=o)}(this||t)._x0=r;(this||t)._y0=n;(this||t)._x1=h;(this||t)._y1=s;return this||t}function tree_data(){var t=[];this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)}));return t}function tree_extent(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN((this||t)._x0)?void 0:[[(this||t)._x0,(this||t)._y0],[(this||t)._x1,(this||t)._y1]]}function Quad(e,i,r,n,h){(this||t).node=e;(this||t).x0=i;(this||t).y0=r;(this||t).x1=n;(this||t).y1=h}function tree_find(e,i,r){var n,h=(this||t)._x0,s=(this||t)._y0,a,o,u,l,_=(this||t)._x1,d=(this||t)._y1,f=[],y=(this||t)._root,c,x;y&&f.push(new Quad(y,h,s,_,d));if(null==r)r=Infinity;else{h=e-r,s=i-r;_=e+r,d=i+r;r*=r}while(c=f.pop())if(!(!(y=c.node)||(a=c.x0)>_||(o=c.y0)>d||(u=c.x1)<h||(l=c.y1)<s))if(y.length){var v=(a+u)/2,p=(o+l)/2;f.push(new Quad(y[3],v,p,u,l),new Quad(y[2],a,p,v,l),new Quad(y[1],v,o,u,p),new Quad(y[0],a,o,v,p));if(x=(i>=p)<<1|e>=v){c=f[f.length-1];f[f.length-1]=f[f.length-1-x];f[f.length-1-x]=c}}else{var w=e-+(this||t)._x.call(null,y.data),g=i-+(this||t)._y.call(null,y.data),N=w*w+g*g;if(N<r){var Q=Math.sqrt(r=N);h=e-Q,s=i-Q;_=e+Q,d=i+Q;n=y.data}}return n}function tree_remove(e){if(isNaN(_=+(this||t)._x.call(null,e))||isNaN(d=+(this||t)._y.call(null,e)))return this||t;var i,r=(this||t)._root,n,h,s,a=(this||t)._x0,o=(this||t)._y0,u=(this||t)._x1,l=(this||t)._y1,_,d,f,y,c,x,v,p;if(!r)return this||t;if(r.length)while(true){(c=_>=(f=(a+u)/2))?a=f:u=f;(x=d>=(y=(o+l)/2))?o=y:l=y;if(!(i=r,r=r[v=x<<1|c]))return this||t;if(!r.length)break;(i[v+1&3]||i[v+2&3]||i[v+3&3])&&(n=i,p=v)}while(r.data!==e)if(!(h=r,r=r.next))return this||t;(s=r.next)&&delete r.next;if(h)return s?h.next=s:delete h.next,this||t;if(!i)return(this||t)._root=s,this||t;s?i[v]=s:delete i[v];(r=i[0]||i[1]||i[2]||i[3])&&r===(i[3]||i[2]||i[1]||i[0])&&!r.length&&(n?n[p]=r:(this||t)._root=r);return this||t}function removeAll(e){for(var i=0,r=e.length;i<r;++i)this.remove(e[i]);return this||t}function tree_root(){return(this||t)._root}function tree_size(){var t=0;this.visit((function(e){if(!e.length)do{++t}while(e=e.next)}));return t}function tree_visit(e){var i=[],r,n=(this||t)._root,h,s,a,o,u;n&&i.push(new Quad(n,(this||t)._x0,(this||t)._y0,(this||t)._x1,(this||t)._y1));while(r=i.pop())if(!e(n=r.node,s=r.x0,a=r.y0,o=r.x1,u=r.y1)&&n.length){var l=(s+o)/2,_=(a+u)/2;(h=n[3])&&i.push(new Quad(h,l,_,o,u));(h=n[2])&&i.push(new Quad(h,s,_,l,u));(h=n[1])&&i.push(new Quad(h,l,a,o,_));(h=n[0])&&i.push(new Quad(h,s,a,l,_))}return this||t}function tree_visitAfter(e){var i=[],r=[],n;(this||t)._root&&i.push(new Quad((this||t)._root,(this||t)._x0,(this||t)._y0,(this||t)._x1,(this||t)._y1));while(n=i.pop()){var h=n.node;if(h.length){var s,a=n.x0,o=n.y0,u=n.x1,l=n.y1,_=(a+u)/2,d=(o+l)/2;(s=h[0])&&i.push(new Quad(s,a,o,_,d));(s=h[1])&&i.push(new Quad(s,_,o,u,d));(s=h[2])&&i.push(new Quad(s,a,d,_,l));(s=h[3])&&i.push(new Quad(s,_,d,u,l))}r.push(n)}while(n=r.pop())e(n.node,n.x0,n.y0,n.x1,n.y1);return this||t}function defaultX(t){return t[0]}function tree_x(e){return arguments.length?((this||t)._x=e,this||t):(this||t)._x}function defaultY(t){return t[1]}function tree_y(e){return arguments.length?((this||t)._y=e,this||t):(this||t)._y}function quadtree(t,e,i){var r=new Quadtree(null==e?defaultX:e,null==i?defaultY:i,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function Quadtree(e,i,r,n,h,s){(this||t)._x=e;(this||t)._y=i;(this||t)._x0=r;(this||t)._y0=n;(this||t)._x1=h;(this||t)._y1=s;(this||t)._root=void 0}function leaf_copy(t){var e={data:t.data},i=e;while(t=t.next)i=i.next={data:t.data};return e}var i=quadtree.prototype=Quadtree.prototype;i.copy=function(){var e=new Quadtree((this||t)._x,(this||t)._y,(this||t)._x0,(this||t)._y0,(this||t)._x1,(this||t)._y1),i=(this||t)._root,r,n;if(!i)return e;if(!i.length)return e._root=leaf_copy(i),e;r=[{source:i,target:e._root=new Array(4)}];while(i=r.pop())for(var h=0;h<4;++h)(n=i.source[h])&&(n.length?r.push({source:n,target:i.target[h]=new Array(4)}):i.target[h]=leaf_copy(n));return e};i.add=tree_add;i.addAll=addAll;i.cover=tree_cover;i.data=tree_data;i.extent=tree_extent;i.find=tree_find;i.remove=tree_remove;i.removeAll=removeAll;i.root=tree_root;i.size=tree_size;i.visit=tree_visit;i.visitAfter=tree_visitAfter;i.x=tree_x;i.y=tree_y;e.quadtree=quadtree;Object.defineProperty(e,"__esModule",{value:true})}));const i=e.quadtree,r=e.__esModule;export default e;export{r as __esModule,i as quadtree};

